<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TRTRSLF</title>

<style>
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#f6f0e6;
  font-family:Georgia,"Times New Roman",serif;
  color:#2b2b2b;
}
#game{
  width:min(860px,96%);
  padding:48px 40px;
  background:#fbf6ec;
  border:1px solid #d8cdb8;
  text-align:center;
}
h1{
  letter-spacing:.35em;
  margin:0;
}
.subtitle{
  font-style:italic;
  color:#6b6458;
  margin-bottom:16px;
}
select,button,input{
  font-family:inherit;
  font-size:18px;
}
#cipher{
  font-size:48px;
  letter-spacing:.14em;
  margin:24px 0 8px;
  min-height:60px;
}
#clue{
  font-style:italic;
  color:#6b6458;
  min-height:24px;
}
input{
  width:100%;
  max-width:620px;
  border:none;
  border-bottom:3px solid #b9b09c;
  background:transparent;
  font-size:28px;
  text-align:center;
  margin:20px auto;
  outline:none;
}
.controls{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}
button{
  padding:10px 16px;
  background:#efe6d3;
  border:1px solid #b9b09c;
  cursor:pointer;
}
#feedback{
  min-height:28px;
  margin-top:12px;
  font-style:italic;
}
.footer{
  margin-top:24px;
  font-style:italic;
  color:#7a7367;
}
.version{
  font-size:13px;
  color:#9a9387;
  margin-top:8px;
}
</style>
</head>

<body>
<div id="game">
  <h1>TRTRSLF</h1>
  <div class="subtitle">Translate the Self</div>

  <select id="category">
    <option value="">All categories</option>
    <option value="biblical">Biblical</option>
    <option value="movies">Movies</option>
    <option value="pop">Pop culture</option>
  </select>

  <div id="cipher">—</div>
  <div id="clue"></div>

  <input id="answer" placeholder="Type your translation…" autocomplete="off"/>

  <div class="controls">
    <button id="submitBtn">Submit</button>
    <button id="vowelsBtn">Show vowels</button>
    <button id="revealBtn">Reveal</button>
    <button id="nextBtn">Next</button>
  </div>

  <div id="feedback"></div>

  <div class="footer">
    A small game about consonants, context, and interpretation.
  </div>
  <div class="version">v2.02</div>
</div>

<script>
let currentPuzzle = null;

function loadPuzzle(){
  const cat = document.getElementById("category").value;
  const url = cat
    ? `https://trtrslf-api.vercel.app/api/puzzle?category=${cat}`
    : `https://trtrslf-api.vercel.app/api/puzzle`;

  fetch(url)
    .then(r => r.json())
    .then(data => {
      console.log("PUZZLE:", data);
      currentPuzzle = data;

      document.getElementById("cipher").textContent = data.noVowels;
      document.getElementById("clue").textContent = data.meta?.clue || "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer").value = "";
    })
    .catch(err => {
      console.error(err);
      document.getElementById("cipher").textContent = "Error loading puzzle";
    });
}

document.getElementById("submitBtn").onclick = () => {
  if(!currentPuzzle) return;
  const guess = document.getElementById("answer").value.trim().toUpperCase();
  document.getElementById("feedback").textContent =
    guess === currentPuzzle.phrase
      ? currentPuzzle.meta?.learn || "Correct."
      : currentPuzzle.meta?.nudge || "Try again.";
};

document.getElementById("vowelsBtn").onclick = () => {
  if(currentPuzzle)
    document.getElementById("cipher").textContent = currentPuzzle.phrase;
};

document.getElementById("revealBtn").onclick = () => {
  if(currentPuzzle)
    document.getElementById("cipher").textContent = currentPuzzle.phrase;
};

document.getElementById("nextBtn").onclick = loadPuzzle;
document.getElementById("category").onchange = loadPuzzle;

loadPuzzle();
</script>
</body>
</html>
